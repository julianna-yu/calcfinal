<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel = "stylesheet" id = "cssfile" href="styles.css">
        <link rel="shortcut icon" href="icon.jpg" type="image/x-icon"/>
        <link href='https://fonts.googleapis.com/css?family=Archivo' rel='stylesheet'>
        <title>2D | CALC FINAL</title>
        <script src="https://unpkg.com/mathjs@7.0.1/dist/math.min.js"></script>
        <script src = "scripts.js"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    </head>
    <body>
        <!-- navigation bar -->
        <div class = "navbar">
            <div class = "title">Rohan & Julianna's AP Calculus Final Project</div>
            <a href="three-d.html">3D Representation</a>
            <a href="two-d.html">2D Representation</a>
            <a href="index.html">Home</a>
        </div>
        <br/>
        <!-- header -->
        <div class = "heading">
            2D REPRESENTATION
        </div>
        <!-- form with options and such -->
        <form id="form">
          <label for="eq">Enter an equation:</label>
          <input type="text" id="eq" value="4 * sin(x) + 5 * cos(x/2)" />
          <br>
          <br>
          <label for="lowerbound">Bounds: </label>
          <input type="text" id="lowerbound" value="-10"/>to
          <input type="text" id="upperbound" value="10"/>
          <br>
          <br>
          <label for="type">What type of riemann sum?</label>
          <select name="type" id="type">
            <option value="leftEnd">left-endpoint</option>
            <option value="rightEnd">right-endpoint</option>
            <option value="mid">midpoint</option>
          </select>
          <br>
          <br>
          <label for="numrect">Number of Rectangles: </label>
          <input type="text" id="numrect" value="1"/>
          <input type="range" id="slider" min="1" max="250" value="1" oninput="changeSlideToText()"/>
          <br>
          <br>
          <input type="submit" value="Draw" onsubmit="Plotly.plot(CHART,data,moreRects(lb,ub-step,xMin,xMax,yMin,yMax,expr))"/>
        </form>
        <!-- div for the graph/chart -->

        <!-- if using plotly.js; https://plotly.com/javascript/getting-started/ -->
        <div id = "myChart0" style="height: 600px"></div>
        <script>
          function changeSlideToText(){
            document.getElementById('numrect').value = document.getElementById('slider').value
          }
          function draw(){
            CHART = document.getElementById('myChart0')
            try{
              const expression = document.getElementById('eq').value
              const expr = math.compile(expression)
              const step = 0.25
              var lb = document.getElementById('lowerbound').value
              var ub = document.getElementById('upperbound').value
              ub = parseInt(ub) + step
              lb = parseInt(lb)
              const xValues = math.range(lb,ub,step).toArray()
              const yValues = xValues.map(function (x) {
                return expr.evaluate({x: x})
              });
              var yMax = yValues.reduce(function(a,b){
                return Math.max(a,b);
              });
              var yMin = yValues.reduce(function(a,b){
                return Math.min(a,b);
              });
              var xMax = xValues.reduce(function(a,b){
                return Math.max(a,b);
              });
              var xMin = xValues.reduce(function(a,b){
                return Math.min(a,b);
              });

              if(yMin > 0) yMin = 0;

              const trace1 = {
                x: xValues,
                y: yValues,
                type: 'scatter',
                line: {shape: 'spline', smoothing: 1.3}
              }
              const data = [trace1]
              var layout = moreRects(lb,ub-step,xMin,xMax,yMin,yMax,expr)
              Plotly.newPlot(CHART,data,layout)
            }
            catch (err) {
              console.error(err)
              alert(err)
            }
          }
          function moreRects(lb,ub,xMin,xMax,yMin,yMax,expr) {
            var n = document.getElementById('numrect').value;
            var thisObject = {};
            thisObject.shapes = [];
            for(i = 0; i < n; i++){
              let scope = {x: (ub-lb)/n * i + (ub-lb)/n + lb}
              thisObject.shapes.push({
                type: 'rect',
                xref: 'x',
                yref: 'y',
                x0: (ub-lb)/n * i + lb,
                y0: 0,
                x1: (ub-lb)/n * i + (ub-lb)/n + lb,
                y1: expr.evaluate(scope),
                fillcolor: 'green',
                opacity: 0.5,
                line: {width: 0}
              });
            }
            thisObject.xaxis = {range: [xMin-2,xMax+2]}
            thisObject.yaxis = {range: [yMin-2,yMax+2]}
            return thisObject;
          }
          document.getElementById('form').onsubmit = function (event){
            event.preventDefault()
            draw()
          }
          draw()
        </script>
        <!-- if using chart.js; chartjs.org/docs/latest/-->
        <canvas id = "myChart1" width = "600px" height = "250px"></canvas>

        <!-- example using math.js and plotly.js: https://mathjs.org/examples/browser/plot.html.html -->
    </body>
</html>
